<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="utf-8" />
  <title>Aozora Scraper</title>
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline';">
  <link rel="stylesheet" href="css/index.css">
  <link rel="stylesheet" href="css/button.css">
</head>

<body>
  <h1 id="maintitle">Aozora Scraper</h1>
  <div class="operation_area">
    <h3 id="scraping">Scraping</h3>
    <div>
      <input type="radio" name="mode" value="file" onchange="radioChanged(this.value)" checked><label id="getfile"
        for="getfile">GetFile</label>
      <input type="radio" name="mode" value="book" onchange="radioChanged(this.value)"><label id="getbook"
        for="getbook">GetBook</label>
      <input type="radio" name="mode" value="author" onchange="radioChanged(this.value)"><label id="getauthor"
        for="getauthor">GetAuthor</label>
      <input type="radio" name="mode" value="title" onchange="radioChanged(this.value)"><label id="gettitle"
        for="gettitle">GetTitle</label>
    </div>
    <div id="startnum_area" class="number01 display-none">
      <h3 id="startnumHead">Start number (1-2410)</h3>
      <input id="startnum" type="number" min="1" max="2410" value="1">
    </div>
    <div id="endnum_area" class="number01 display-none">
      <h3 id="endnumHead">End number (2-2410)</h3>
      <input id="endnum" type="number" min="2" max="2410" value="2410">
    </div>
    <div id="select_en" class="cp_ipselect02">
      <select id="starten" name="start">
        <option value="all">all</option>
        <option value="a">a</option>
        <option value="ka">ka</option>
        <option value="sa">sa</option>
        <option value="ta">ta</option>
        <option value="na">na</option>
        <option value="ha">ha</option>
        <option value="ma">ma</option>
        <option value="ya">ya</option>
        <option value="ra">ra</option>
        <option value="wa">wa</option>
        <option value="a-z">a-z</option>
      </select>
    </div>
    <div id="select_ja" class="cp_ipselect02">
      <select id="startja" name="start">
        <option value="all">全</option>
        <option value="a">あ</option>
        <option value="ka">か</option>
        <option value="sa">さ</option>
        <option value="ta">た</option>
        <option value="na">な</option>
        <option value="ha">は</option>
        <option value="ma">ま</option>
        <option value="ya">や</option>
        <option value="ra">ら</option>
        <option value="wa">わ</option>
        <option value="a-z">a-z</option>
      </select>
    </div>
    <button id="scraping_button" class="button-g button-wide" value="scraping" onclick="gotoScrape();">Scraping</button>
  </div>
  <div class="operation_area">
    <h3 id="config">Config</h3>
    <button id="config_button" class="button-g button-6 button-wide" value="config"
      onclick="gotoConfig()">Config</button>
  </div>
  <div class="operation_area">
    <h3 id="statushead">Status</h3>
    <div id="targetpage"></div>
    <div id="status"></div>
  </div>
  <div class="operation_area">
    <button id="exit_button" class="button-g button-1 button-wide" value="exit" onclick="exitApp();">Exit</button>
  </div>
  <footer>
    <p><small>&copy; 2025 Nthree LLC. All Rights Reserved. </small></p>
  </footer>

  <script charset="UTF-8">
    /// constants
    // japanese
    const APPNAME_STR_JA = '青空スクレイパー';
    const SCRAPING_STR_JA = 'スクレイピング';
    const GETFILES_STR_JA = 'ファイル取得';
    const GETBOOKS_STR_JA = '作品取得';
    const GETAUTHORS_STR_JA = '著者取得';
    const GETTITLES_STR_JA = 'タイトル取得';
    const STARTNUM_STR_JA = '開始位置(1-2410)';
    const ENDNUM_STR_JA = '終了位置(2-2410)';
    const CONFIG_STR_JA = '設定';
    const STATUS_STR_JA = '状態:';
    const EXIT_STR_JA = '終了';
    // english
    const APPNAME_STR_EN = 'Aozora Scraper';
    const SCRAPING_STR_EN = 'Scraping';
    const GETFILES_STR_EN = 'GetFiles';
    const GETBOOKS_STR_EN = 'GetBooks';
    const GETAUTHORS_STR_EN = 'GetAuthors';
    const GETTITLES_STR_EN = 'GetTitles';
    const STARTNUM_STR_EN = 'Start number (1-2410)';
    const ENDNUM_STR_EN = 'End number (2-2410)';
    const CONFIG_STR_EN = 'Config';
    const STATUS_STR_EN = 'status:';
    const EXIT_STR_EN = 'Exit';
    // doms
    const maintitleDom = document.getElementById("maintitle");
    const selectJaDom = document.getElementById("select_ja");
    const selectEnDom = document.getElementById("select_en");
    const startNumDom = document.getElementById("startnum");
    const endNumDom = document.getElementById("endnum");
    const startAreaNumDom = document.getElementById("startnum_area");
    const endAreaNumDom = document.getElementById("endnum_area");
    const startHeadNumDom = document.getElementById("startnumHead");
    const endHeadNumDom = document.getElementById("endnumHead");
    const startJaDom = document.getElementById("startja");
    const startEnDom = document.getElementById("starten");
    const scrapeDom = document.getElementById('scraping');
    const getfileDom = document.getElementById('getfile');
    const getbookDom = document.getElementById('getbook');
    const getauthorDom = document.getElementById('getauthor');
    const gettitleDom = document.getElementById('gettitle');
    const scrapeButtonDom = document.getElementById('scraping_button');
    const configDom = document.getElementById('config');
    const configButtonDom = document.getElementById('config_button');
    const pageDom = document.getElementById('targetpage');
    const statusHeadDom = document.getElementById('statushead');
    const statusDom = document.getElementById('status');
    const exitButtonDom = document.getElementById('exit_button');
    /// variables
    let globalLanguage = 'japanese'

    /// ipc
    // before ready
    window.api.send("beforeready");

    // be ready
    window.api.on("ready", arg => {
      // change language
      changeLanguage(arg);
    });

    // update status
    window.api.on('statusUpdate', arg => {
      try {
        // status
        statusDom.innerHTML = `
          scraping: ${arg.status}`;
        // target
        pageDom.innerHTML = `
          target: ${arg.target}`;

      } catch (e) {
        // error
        console.log(e);
      }
    });

    // start scraping
    const gotoScrape = () => {
      try {
        // start
        let tmpStart = '';
        // get radio
        const value = document.querySelector("input[name='mode']:checked").value;
        // get select
        if (globalLanguage == 'japanese') {
          tmpStart = startJaDom.value;
        } else {
          tmpStart = startEnDom.value;
        }

        // mode switch
        switch (value) {
          // file mode
          case "file":
            // file scrape
            window.api.send('download', tmpStart);
            break;

          // book mode
          case "book":
            // bookscrape
            window.api.send('bookscrape', tmpStart);
            break;

          // title mode
          case "title":
            // title scrape
            window.api.send('titlescrape', tmpStart);
            break;

          // author mode
          case "author":
            const tmpObj = {
              start: startNumDom.value,
              end: endNumDom.value
            }
            // author scrape
            window.api.send('authorscrape', tmpObj);
            break;

          default:
            console.log('invalid mode');
        }

      } catch (e) {
        // error
        console.log(e);
      }
    }

    // goto config page
    const gotoConfig = () => {
      try {
        // scrape
        window.api.send('config');

      } catch (e) {
        // error
        console.log(e);
      }
    }

    // on radio changed
    const radioChanged = (value) => {
      try {
        // initialize form
        if (value === 'author') {
          startAreaNumDom.classList.remove("display-none");
          endAreaNumDom.classList.remove("display-none");
          // japanese
          if (globalLanguage == 'japanese') {
            selectJaDom.classList.add("display-none");
          } else {
            selectEnDom.classList.add("display-none");
          }
        } else {
          startAreaNumDom.classList.add("display-none");
          endAreaNumDom.classList.add("display-none");
          // japanese
          if (globalLanguage == 'japanese') {
            selectJaDom.classList.remove("display-none");
          } else {
            selectEnDom.classList.remove("display-none");
          }
        }

      } catch (e) {
        // error
        console.log(e);
      }
    }

    // exit
    const exitApp = () => {
      try {
        // exit app
        window.api.send('exitapp');

      } catch (e) {
        // error
        console.log(e);
      }
    }

    // change language
    const changeLanguage = lang => {
      // set global
      globalLanguage = lang;
      // japanese
      if (lang == 'japanese') {
        selectJaDom.classList.remove("display-none");
        selectEnDom.classList.add("display-none");
        document.title = APPNAME_STR_JA;
        maintitleDom.innerHTML = APPNAME_STR_JA;
        scrapeDom.innerHTML = SCRAPING_STR_JA;
        getfileDom.innerHTML = GETFILES_STR_JA;
        getbookDom.innerHTML = GETBOOKS_STR_JA;
        getauthorDom.innerHTML = GETAUTHORS_STR_JA;
        gettitleDom.innerHTML = GETTITLES_STR_JA;
        startHeadNumDom.innerHTML = STARTNUM_STR_JA;
        endHeadNumDom.innerHTML = ENDNUM_STR_JA;
        scrapeButtonDom.innerHTML = SCRAPING_STR_JA;
        configDom.innerHTML = CONFIG_STR_JA;
        configButtonDom.innerHTML = CONFIG_STR_JA;
        statusHeadDom.innerHTML = STATUS_STR_JA;
        exitButtonDom.innerHTML = EXIT_STR_JA;
        document.documentElement.setAttribute("lang", 'ja');
        // english
      } else {
        selectJaDom.classList.add("display-none");
        selectEnDom.classList.remove("display-none");
        document.title = APPNAME_STR_EN;
        maintitleDom.innerHTML = APPNAME_STR_EN;
        scrapeDom.innerHTML = SCRAPING_STR_EN;
        getfileDom.innerHTML = GETFILES_STR_EN;
        getbookDom.innerHTML = GETBOOKS_STR_EN;
        getauthorDom.innerHTML = GETAUTHORS_STR_EN;
        gettitleDom.innerHTML = GETTITLES_STR_EN;
        startHeadNumDom.innerHTML = STARTNUM_STR_EN;
        endHeadNumDom.innerHTML = ENDNUM_STR_EN;
        scrapeButtonDom.innerHTML = SCRAPING_STR_EN;
        configDom.innerHTML = CONFIG_STR_EN;
        configButtonDom.innerHTML = CONFIG_STR_EN;
        statusHeadDom.innerHTML = STATUS_STR_EN;
        exitButtonDom.innerHTML = EXIT_STR_EN;
        document.documentElement.setAttribute("lang", 'en');
      }
    }
  </script>
</body>

</html>